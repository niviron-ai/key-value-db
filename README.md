# @dieugene/key-value-db

[![npm version](https://badge.fury.io/js/@dieugene%2Fkey-value-db.svg)](https://badge.fury.io/js/@dieugene%2Fkey-value-db)
[![License: ISC](https://img.shields.io/badge/License-ISC-blue.svg)](https://opensource.org/licenses/ISC)

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ YDB (Yandex Database). –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, –ø–æ–ª—É—á–µ–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è JSON-–¥–∞–Ω–Ω—ã–º–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–æ–º–µ–Ω–æ–≤ –∏ –≥–∏–±–∫–∏–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ –ø–æ–∏—Å–∫–∞.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üîë **–†–∞–±–æ—Ç–∞ —Å –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–∏**: –ü—Ä–æ—Å—Ç–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ JSON-–æ–±—ä–µ–∫—Ç–æ–≤
- üè∑Ô∏è **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ–º–µ–Ω–æ–≤**: –õ–æ–≥–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ –¥–æ–º–µ–Ω–∞–º —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø—Ä–µ—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- üîç **–ì–∏–±–∫–∏–π –ø–æ–∏—Å–∫**: –ü–æ–∏—Å–∫ –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É, —Å—É—Ñ—Ñ–∏–∫—Å—É –∏–ª–∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –¥–æ–º–µ–Ω–∞
- ‚ö° **–ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- üìã **–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –º–µ–∂–¥—É –∫–ª—é—á–∞–º–∏
- üóÑÔ∏è **YDB –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Yandex Database –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install @dieugene/key-value-db
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js >= 16.0.0
- Yandex Database (YDB) serverless instance

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```javascript
const { init } = require('@dieugene/key-value-db');

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ –¥–æ–º–µ–Ω–∞
const db = init();

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –¥–æ–º–µ–Ω–æ–º
const userDb = init('users', {
  table_name: 'my_table',
  database: process.env.YDB_ADDRESS
});

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
await db.set('user:123', { name: 'John', age: 30 });

// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
const user = await db.get('user:123', null);
console.log(user); // { name: 'John', age: 30 }

// –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
await db.del('user:123');
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ YDB:

```bash
export YDB_ADDRESS="/ru-central..."
```

–ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```env
YDB_ADDRESS=grpc://your-ydb-endpoint:2135/path/to/database
```

## API

### `init(domain, options)`

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `domain` (string) - –ü—Ä–µ—Ñ–∏–∫—Å –¥–æ–º–µ–Ω–∞ –¥–ª—è –≤—Å–µ—Ö –∫–ª—é—á–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞)
- `options` (Object) - –û–ø—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  - `table_name` (string) - –ò–º—è —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 'key_object_db')
  - `database` (string) - –ê–¥—Ä–µ—Å YDB (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: process.env.YDB_ADDRESS)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –û–±—ä–µ–∫—Ç —Å –º–µ—Ç–æ–¥–∞–º–∏ `get`, `set`, `del`, `copy`

### –ú–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏

#### `get(id, by_default)`

–ü–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∫–ª—é—á—É.

```javascript
const data = await db.get('user:123', { name: 'Unknown' });
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `id` (string) - –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª—é—á–∞
- `by_default` (any) - –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** Promise —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

#### `get.where_id_starts_with(startsWith)`

–ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Å –∫–ª—é—á–∞–º–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–º–∏—Å—è —Å –∑–∞–¥–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏.

```javascript
const users = await db.get.where_id_starts_with('user:');
```

#### `get.where_id_ends_with(endsWith)`

–ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –¥–æ–º–µ–Ω–∞ —Å –∫–ª—é—á–∞–º–∏, –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∏–º–∏—Å—è –∑–∞–¥–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π.

```javascript
const admins = await db.get.where_id_ends_with(':admin');
```

#### `get.all()`

–ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Ç–µ–∫—É—â–µ–≥–æ –¥–æ–º–µ–Ω–∞.

```javascript
const allData = await db.get.all();
```

#### `set(id, data)`

–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–ª—é—á—É.

```javascript
await db.set('user:123', { name: 'John', role: 'admin' });
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `id` (string) - –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª—é—á–∞
- `data` (any) - –î–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** Promise —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

#### `set.bulk(data_list)`

–ú–∞—Å—Å–æ–≤–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.

```javascript
await db.set.bulk([
  { id: 'user:1', data: { name: 'John' } },
  { id: 'user:2', data: { name: 'Jane' } }
]);
```

#### `set.sub_domain(subDomain)`

–°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –ë–î —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º –¥–æ–º–µ–Ω–æ–º.

```javascript
const profileDb = db.set.sub_domain('profiles');
// –ö–ª—é—á–∏ –±—É–¥—É—Ç –∏–º–µ—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å: domain::profiles::
```

#### `copy(from_id, to_id, value_if_null)`

–ö–æ–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç –æ–¥–Ω–æ–≥–æ –∫–ª—é—á–∞ –∫ –¥—Ä—É–≥–æ–º—É.

```javascript
await db.copy('user:123', 'user:123:backup', {});
```

#### `del(id)`

–£–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –ø–æ –∫–ª—é—á—É.

```javascript
await db.del('user:123');
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –†–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

```javascript
const { init } = require('./main.js');

const userDb = init('users');

// –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
await userDb.set('123', {
  id: 123,
  name: 'John Doe',
  email: 'john@example.com',
  created: new Date().toISOString()
});

// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const user = await userDb.get('123');

// –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
const allUsers = await userDb.get.all();

// –ü–æ–∏—Å–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
const admins = await userDb.get.where_id_ends_with(':admin');
```

### –†–∞–±–æ—Ç–∞ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```javascript
const configDb = init('config');

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
await configDb.set('app', {
  theme: 'dark',
  language: 'ru',
  notifications: true
});

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
await configDb.set('user:123', {
  theme: 'light',
  autoSave: true
});

// –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
const allConfigs = await configDb.get.all();
```

### –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

```javascript
const dataDb = init('analytics');

// –ú–∞—Å—Å–æ–≤–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
const metrics = [
  { id: 'daily:2024-01-01', data: { views: 1000, clicks: 50 } },
  { id: 'daily:2024-01-02', data: { views: 1200, clicks: 60 } },
  { id: 'daily:2024-01-03', data: { views: 950, clicks: 45 } }
];

await dataDb.set.bulk(metrics);

// –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–Ω–µ–≤–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
const dailyMetrics = await dataDb.get.where_id_starts_with('daily:');
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `YDB_ADDRESS` - –ê–¥—Ä–µ—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ YDB

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `@dieugene/ydb-serverless` - –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å YDB
- `@dieugene/utils` - –£—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

## –ê–≤—Ç–æ—Ä

Eugene Ditkovsky

## –õ–∏—Ü–µ–Ω–∑–∏—è

ISC
 
